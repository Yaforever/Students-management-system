{% load staticfiles %}
<!DOCTYPE HTML>
<html>

<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" type="text/css" href="{% static 'stud/style.css' %}" />
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js" type="text/javascript"></script>
	
</head>

<body vlink="#0000FF">
<div class="header">
<a href='/' style="color: black">STUDENTS MANAGEMENT</a>
</div>

<div class="main">
	<div class="auth">
		<li class="out"><a href='/auth/logout/'>Выйти ({{ user }})</a></li>
	</div>
	<div class="addd">
	<form class="firstform" action='/edit/' method='post'>
		{% csrf_token %}
		<h3 class="s">Добавить группу</h3>
		<label for='name'>Название группы</label>
		<input class="else" type="text" size="15" maxlength="10" name='name' id='name'></input>
		<input type='submit' value='+'></input>
		</br>
	</form> 
	<h3>Добавить студента</h3>
	<form action='/edit/' method='post'>
		{% csrf_token %}
		<label for='surname'>ФИО</label>
		<input type="text" maxlength="30" size="30" name='surname' id='surname'></input>

		<label for='num'>№ студенческого</label>
		<input type="text" maxlength="10" size="10" name='num' id='num'></input><br>

		<label for='year'>Год рождения</label>
		<select name='year' class="year">
			{% for i in y %}
		  		<option>{{i}}</option>
		  	{% endfor %}
		</select>

		<label for='month'>месяц</label>
		<select name='month' class="month">
			{% for i in m %}
		  		<option>{{i}}</option>
		  	{% endfor %}
		</select>

		<label for='day'>день</label>
		<select name='day' class="day">
		  	{% for i in d %}
		  		<option class="{{i}}">{{ i }}</option>
		  	{% endfor %}
		</select>


		<label for='group'>Группа</label>
		<select name='group'>
			{% for g in groups %}
				{% if g.groupname == laststud.group %}
		  			<option selected="g.groupname">{{g.groupname}}</option>
		  		{% else %}
		  			<option>{{g.groupname}}</option>
				{% endif %}
		  	{% endfor %}
		</select>
		<input type='submit' value='+'></input>
	</form>
	</div>
	<ul>
	<div class="all_gr">
		{% for group in groups %}
			<li class="line"><b>{{ group.groupname }}</b></li>
			<form class="lin" action='/edit/' method='post'>
				{% csrf_token %}
				<button class="delgroup" name="delgroup" value='{{group.id}}' alt="Удалить"></button>
			</form>
			
			<button class="redgroup" name="redgroup" id='{{group.id}}' alt="Редактировать"></button>
			<form class="redgroups" action='/edit/' method='post' id='{{group.id}}'>
				{% csrf_token %}
				
				<input type="hidden" name='rgroupid' class="rgroupid" value="{{group.id}}"></input>
				<input class="redgroups" type="text" maxlength="10" name='rname' value="{{group.groupname}}"></input>
				<input class="redgroups" type='submit' value='Edit'></input>
				Староста
				<select name="rmainstudent">
					{% for i in group.student_set.all %}
						{% if i.name == group.mainstudent %}
							<option selected="{{i.name}}">{{i.name}}</option>
						{% else %}
							<option>{{i.name}}</option>
						{% endif %}
					{% endfor %}
				</select>

			</form>
			
			<div class="space"></div>

			{% for s in group.student_set.all %}
				<li class="sline">{{ s.name }}; {{ s.date }}; {{ s.num }}</li>
				<form class="lin" action='/edit/' method='post'>
					{% csrf_token %}
					<button class="delstud" name="delstud" value="{{s.id}}" alt="Удалить"></button>
					<button type="button" class="redstud" name="redstud" value="{{s.id}}" alt="Редактировать"></button>

					<div class="editstud">
							<input type="hidden" name='rstudid' class="rstudid" value="{{s.id}}"></input>
							<label for='rsurname'>ФИО</label>
							<input type="text" maxlength="30" name='rsurname' size="30" id='rsurname' value="{{s.name}}"></input>

							<label for='rnum'>№ студенческого</label>
							<input type="text" maxlength="10" name='rnum' size="10" id='rnum' value="{{s.num}}"></input><br>

							<label for='ryear'>Год рождения</label>
							<select name='ryear' class="ryear">
								{% for i in y %}
									{% if i == s.date.year %}
										<option selected="i">{{i}}</option>
									{% else %}}
										<option>{{i}}</option>
									{% endif %}
							 	{% endfor %}
							</select>

							<label for='rmonth'>месяц</label>
							<select name='rmonth' class="rmonth">
								{% for i in m %}
									{% if i == s.date.month %}
										<option selected="i">{{i}}</option>
									{% else %}}
										<option>{{i}}</option>
									{% endif %}
							 	{% endfor %}
							</select>

							<label for='rday'>день</label>
							<select name='rday' class="rday" >
								{% for i in d %}
									{% if i == s.date.day %}
										<option selected="i">{{i}}</option>
									{% else %}}
										<option class="r{{i}}">{{i}}</option>
									{% endif %}
							 	{% endfor %}
							</select>

							<label for='rgroup'>Группа</label>
							<select name='rgroup'>
								{% for group in groups %}
									{% if group.groupname == s.group.groupname %}
							  			<option selected="group.groupname">{{group.groupname}}</option>
									{% else %}
										<option>{{group.groupname}}</option>
									{% endif %}
							  	{% endfor %}
							</select>
							<input type='submit' value='Edit' style="border-bottom-right-radius: 10px"></input>
							
					</div>

					
				</form>
				<div class="space"></div>
			{% endfor %}

		{% endfor %}

	</div>
	</ul>
	</div>
	</div>
</div>
	<script type="text/javascript">
		$(document).ready(function(){

			$(".editstud, .redgroups").hide();
			$(".redgroup").click(function(){
				$(".redgroups").hide();
				var redgroup = $(this).siblings("#" + this.id).show()
				redgroup.children().show()

			});
			$(".redstud").click(function(){
				$('.editstud').hide();
				var redstud = $(this).siblings(".editstud").show();
				var ry = $(redstud).children(".ryear").val();	
				var rm = $(redstud).children(".rmonth").val();
				var rd = $(redstud).children(".rday").val();

				//если год високосный и месяц = февраль, то показать 29-е февраля
				if(rm == 2 & ry == 2016 | rm == 2 & ry == 2012 | rm == 2 & ry == 2008 | 
					rm == 2 & ry == 2004 | rm == 2 & ry == 2000 | rm == 2 & ry == 1996 | 
					rm == 2 & ry == 1992 | rm == 2 & ry == 1988 | rm == 2 & ry == 1984 | 
					rm == 2 & ry == 1980 | rm == 2 & ry == 1976 | rm == 2 & ry == 1972){
					$('.r30, .r31').hide();
					$('.r29').show();
					if(rd > 29){
						$('.rday').val(29);
					}
				}
				//если месяц = февраль, то скрыть 29, 30, 31 числа
				else if(rm == 2){
					$('.r31, .r30, .r29').hide()
					if(rd > 28){
						$('.rday').val(28);
					}
				}
				else if(rm == 4 | rm == 6 | rm == 9 | rm == 11){
					$('.r31').hide();
					$('.r30, .r29').show()
					if(rd > 30){
						$('.rday').val(30);
					}
				}
				else{
						$('.r31, .r30, .r29').show()
				}
			});

			$(".year, .month").change(function(){
				var y = $('.year').val();
				var m = $('.month').val();
				var d = $('.day').val();
				if(m == 2 & y == 2016 | m == 2 & y == 2012 | m == 2 & y == 2008 | 
					m == 2 & y == 2004 | m == 2 & y == 2000 | m == 2 & y == 1996 | 
					m == 2 & y == 1992 | m == 2 & y == 1988 | m == 2 & y == 1984 | 
					m == 2 & y == 1980 | m == 2 & y == 1976 | m == 2 & y == 1972){
					$('.30, .31').hide();
					$('.29').show();
					if(d > 29){
						$('.day').val(29);
					}
				}
				else if(m == 2){
					$('.31, .30, .29').hide()
					if(d > 28){
						$('.day').val(28);
					}
				}
				else if(m == 4 | m == 6 | m == 9 | m == 11){
					$('.31').hide();
					$('.30, .29').show()
					if(d > 30){
						$('.day').val(30);
					}
				}
				else{
					$('.31, .30, .29').show()
				}
			});
			$(".ryear, .rmonth").change(function(){
					var editstud = $(this).parent()
					var ry = $(editstud).children(".ryear").val();
					var rm = $(editstud).children(".rmonth").val();
					var rd = $(editstud).children(".rday").val();
					
					if(rm == 2 & ry == 2016 | rm == 2 & ry == 2012 | rm == 2 & ry == 2008 
						| rm == 2 & ry == 2004 | rm == 2 & ry == 2000 | rm == 2 & ry == 1996 
						| rm == 2 & ry == 1992 | rm == 2 & ry == 1988 | rm == 2 & ry == 1984 
						| rm == 2 & ry == 1980 | rm == 2 & ry == 1976 | rm == 2 & ry == 1972){
						$('.r30, .r31').hide();
						$('.r29').show();
						if(rd > 29){
							$('.rday').val(29);
						}
					}
					else if(rm == 2){
						$('.r31, .r30, .r29').hide()
						if(rd > 28){
							$('.rday').val(28);
						}
					}
					else if(rm == 4 | rm == 6 | rm == 9 | rm == 11){
						$('.r31').hide();
						$('.r30, .r29').show()
						if(rd > 30){
							$('.rday').val(30);
						}
					}
					else{
						$('.r31, .r30, .r29').show()
					}
			});

			
		});
	</script>

</body>
</html>
